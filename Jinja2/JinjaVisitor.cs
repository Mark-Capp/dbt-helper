namespace Jinja2;internal class JinjaVisitor : JinjaParserBaseVisitor<List<Block>>{    public override List<Block> VisitTemplate(JinjaParser.TemplateContext context)    {        var blocks = new List<Block>();        var visitor = new ExpressionVisitor();        var statements = context.children;        foreach (var statement in statements)             blocks.AddRange(visitor.Visit(statement));                return blocks;    }}internal class ExpressionVisitor : JinjaParserBaseVisitor<Block>{    public override Block VisitText(JinjaParser.TextContext context)        => new TextBlock(context.GetText());    public override Block VisitExpression(JinjaParser.ExpressionContext context)         => Visit(context.expression_body());    public override Block VisitEqAssign(JinjaParser.EqAssignContext context)    {        var name = context.ID().GetText();        var expression = Visit(context.expression_body()) as ExpressionBlock;        return new SetBlock(name, expression!);    }    public override Block VisitEqINT(JinjaParser.EqINTContext context)         => new IntBlock(int.Parse(context.INT().GetText()));        public override Block VisitEqID(JinjaParser.EqIDContext context)         => new IdBlock(context.ID().GetText());}public abstract class Block;public abstract class ExpressionBlock : Block{    public abstract object? GetValue(Context context);}public class TextBlock(string content)     : Block, IRender{    public void Render(Context context)         => context.Content += content;}public class SetBlock(string name, ExpressionBlock value) : Block, IRender{    public void Render(Context context)         => context.Variables.TryAdd(name, value);}public class IdBlock(string name) : ExpressionBlock, IRender{    public void Render(Context context)    {        if (!context.Variables.TryGetValue(name, out var value))        {            return;        }        context.Content += value.GetValue(context);    }    public override object? GetValue(Context context)         => !context.Variables.TryGetValue(name, out var value) ? null : value.GetValue(context);}public class IntBlock(int value) : ExpressionBlock{    public override object GetValue(Context context) => value;}public class Context{   public string Content { get; set; } = "";    public Dictionary<string, ExpressionBlock> Variables { get; set; } = new();}public interface IRender{    void Render(Context context);}